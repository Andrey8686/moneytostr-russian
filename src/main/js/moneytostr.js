/*
 * $Id$
 *
 * Copyright 2012 Valentyn Kolesnikov
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

var currencyList =
{
  "CurrencyList": {
    "language": { "-value": "UKR" },
    "UKR": {
      "item": [
        {
          "-value": "0",
          "-text": "нуль"
        },
        {
          "-value": "1000_10",
          "-text": "тисяч,мільйонів,мільярдів,трильйонів"
        },
        {
          "-value": "1000_1",
          "-text": "тисяча,мільйон,мільярд,трильйон"
        },
        {
          "-value": "1000_234",
          "-text": "тисячі,мільйона,мільярда,трильйона"
        },
        {
          "-value": "1000_5",
          "-text": "тисяч,мільйонів,мільярдів,трильйонів"
        },
        {
          "-value": "10_19",
          "-text": "десять,одинадцять,дванадцять,тринадцять,чотирнадцять,п’ятнадцять,шiстнадцять,сiмнадцять,вiсiмнадцять,дев'ятнадцять"
        },
        {
          "-value": "1",
          "-text": "одна,один,один,одна"
        },
        {
          "-value": "2",
          "-text": "дві,два,два,дві"
        },
        {
          "-value": "3_9",
          "-text": "три,чотири,п’ять,шість,сім,вісім,дев’ять"
        },
        {
          "-value": "100_900",
          "-text": "сто ,двісті ,триста ,чотириста ,п’ятсот ,шістсот ,сімсот ,вісімсот ,дев’ятсот "
        },
        {
          "-value": "20_90",
          "-text": "двадцять ,тридцять ,сорок ,п’ятдесят ,шістдесят ,сімдесят ,вісімдесят ,дев’яносто "
        }
      ]
    },
    "RUS": {
      "item": [
        {
          "-value": "0",
          "-text": "ноль"
        },
        {
          "-value": "1000_10",
          "-text": "тысяч,миллионов,миллиардов,триллионов"
        },
        {
          "-value": "1000_1",
          "-text": "тысяча,миллион,миллиард,триллион"
        },
        {
          "-value": "1000_234",
          "-text": "тысячи,миллиона,миллиарда,триллиона"
        },
        {
          "-value": "1000_5",
          "-text": "тысяч,миллионов,миллиардов,триллионов"
        },
        {
          "-value": "10_19",
          "-text": "десять,одиннадцать,двенадцать,тринадцать,четырнадцать,пятнадцать,шестнадцать,семнадцать,восемнадцать,девятнадцать"
        },
        {
          "-value": "1",
          "-text": "одна,один,один,одна"
        },
        {
          "-value": "2",
          "-text": "две,два,два,две"
        },
        {
          "-value": "3_9",
          "-text": "три,четыре,пять,шесть,семь,восемь,девять"
        },
        {
          "-value": "100_900",
          "-text": "сто ,двести ,триста ,четыреста ,пятьсот ,шестьсот ,семьсот ,восемьсот ,девятьсот "
        },
        {
          "-value": "20_90",
          "-text": "двадцать ,тридцать ,сорок ,пятьдесят ,шестьдесят ,семьдесят ,восемьдесят ,девяносто "
        }
      ]
    },
    "RUR": [
      {
        "-CurrID": "810",
        "-CurrName": "Российские рубли",
        "-language": "RUS",
        "-RubOneUnit": "рубль",
        "-RubTwoUnit": "рубля",
        "-RubFiveUnit": "рублей",
        "-RubSex": "M",
        "-KopOneUnit": "копейка",
        "-KopTwoUnit": "копейки",
        "-KopFiveUnit": "копеек",
        "-KopSex": "F"
      },
      {
        "-CurrID": "810",
        "-CurrName": "Российские рубли",
        "-language": "UKR",
        "-RubOneUnit": "рубль",
        "-RubTwoUnit": "рубля",
        "-RubFiveUnit": "рублей",
        "-RubSex": "M",
        "-KopOneUnit": "копейка",
        "-KopTwoUnit": "копейки",
        "-KopFiveUnit": "копеек",
        "-KopSex": "F"
      }
    ],
    "UAH": [
      {
        "-CurrID": "980",
        "-CurrName": "Украинскі гривні",
        "-language": "RUS",
        "-RubOneUnit": "гривня",
        "-RubTwoUnit": "гривни",
        "-RubFiveUnit": "гривень",
        "-RubSex": "F",
        "-KopOneUnit": "копейка",
        "-KopTwoUnit": "копейки",
        "-KopFiveUnit": "копеек",
        "-KopSex": "F"
      },
      {
        "-CurrID": "980",
        "-CurrName": "Украинскі гривні",
        "-language": "UKR",
        "-RubOneUnit": "гривня",
        "-RubTwoUnit": "гривні",
        "-RubFiveUnit": "гривень",
        "-RubSex": "F",
        "-KopOneUnit": "копійка",
        "-KopTwoUnit": "копійки",
        "-KopFiveUnit": "копійок",
        "-KopSex": "F"
      }
    ],
    "USD": [
      {
        "-CurrID": "840",
        "-CurrName": "Долари США",
        "-language": "RUS",
        "-RubOneUnit": "долар",
        "-RubTwoUnit": "долара",
        "-RubFiveUnit": "доларів",
        "-RubSex": "M",
        "-KopOneUnit": "цент",
        "-KopTwoUnit": "цена",
        "-KopFiveUnit": "центов",
        "-KopSex": "M"
      },
      {
        "-CurrID": "840",
        "-CurrName": "Долари США",
        "-language": "UKR",
        "-RubOneUnit": "долар",
        "-RubTwoUnit": "долара",
        "-RubFiveUnit": "доларів",
        "-RubSex": "M",
        "-KopOneUnit": "цент",
        "-KopTwoUnit": "цена",
        "-KopFiveUnit": "центів",
        "-KopSex": "M"
      }
    ],
    "PER10": [
      {
        "-CurrID": "556",
        "-CurrName": "Вiдсотки з десятими частинами",
        "-language": "RUS",
        "-RubOneUnit": "целая,",
        "-RubTwoUnit": "целых,",
        "-RubFiveUnit": "целых,",
        "-RubSex": "F",
        "-KopOneUnit": "десятая процента",
        "-KopTwoUnit": "десятых процента",
        "-KopFiveUnit": "десятых процента",
        "-KopSex": "F"
      },
      {
        "-CurrID": "556",
        "-CurrName": "Вiдсотки з десятими частинами",
        "-language": "UKR",
        "-RubOneUnit": "ціла,",
        "-RubTwoUnit": "цілих,",
        "-RubFiveUnit": "цілих,",
        "-RubSex": "F",
        "-KopOneUnit": "десята відсотка",
        "-KopTwoUnit": "десятих відсотка",
        "-KopFiveUnit": "десятих відсотка",
        "-KopSex": "F"
      }
    ],
    "PER100": [
      {
        "-CurrID": "557",
        "-CurrName": "Вiдсотки з сотими частинами",
        "-language": "RUS",
        "-RubOneUnit": "целая,",
        "-RubTwoUnit": "целых,",
        "-RubFiveUnit": "целых,",
        "-RubSex": "F",
        "-KopOneUnit": "сотая процента",
        "-KopTwoUnit": "сотых процента",
        "-KopFiveUnit": "сотых процента",
        "-KopSex": "F"
      },
      {
        "-CurrID": "557",
        "-CurrName": "Вiдсотки з сотими частинами",
        "-language": "UKR",
        "-RubOneUnit": "ціла,",
        "-RubTwoUnit": "цілих,",
        "-RubFiveUnit": "цілих,",
        "-RubSex": "F",
        "-KopOneUnit": "сота відсотка",
        "-KopTwoUnit": "сотих відсотка",
        "-KopFiveUnit": "сотих відсотка",
        "-KopSex": "F"
      }
    ],
    "PER1000": [
      {
        "-CurrID": "558",
        "-CurrName": "Вiдсотки з тисячними частинами",
        "-language": "RUS",
        "-RubOneUnit": "целая,",
        "-RubTwoUnit": "целых,",
        "-RubFiveUnit": "целых,",
        "-RubSex": "F",
        "-KopOneUnit": "тысячная процента",
        "-KopTwoUnit": "тысячных процента",
        "-KopFiveUnit": "тысячных процента",
        "-KopSex": "F"
      },
      {
        "-CurrID": "558",
        "-CurrName": "Вiдсотки з тисячними частинами",
        "-language": "UKR",
        "-RubOneUnit": "ціла,",
        "-RubTwoUnit": "цілих,",
        "-RubFiveUnit": "цілих,",
        "-RubSex": "F",
        "-KopOneUnit": "тисячна відсотка",
        "-KopTwoUnit": "тисячних відсотка",
        "-KopFiveUnit": "тисячних відсотка",
        "-KopSex": "F"
      }
    ],
    "PER10000": [
      {
        "-CurrID": "559",
        "-CurrName": "Вiдсотки з десяти тисячними частинами",
        "-language": "RUS",
        "-RubOneUnit": "целая,",
        "-RubTwoUnit": "целых,",
        "-RubFiveUnit": "целых,",
        "-RubSex": "F",
        "-KopOneUnit": "десятитысячная процента",
        "-KopTwoUnit": "десятитысячные процента",
        "-KopFiveUnit": "десятитысячных процента",
        "-KopSex": "F"
      },
      {
        "-CurrID": "559",
        "-CurrName": "Вiдсотки з десяти тисячними частинами",
        "-language": "UKR",
        "-RubOneUnit": "ціла,",
        "-RubTwoUnit": "цілих,",
        "-RubFiveUnit": "цілих,",
        "-RubSex": "F",
        "-KopOneUnit": "десятитисячна відсотка",
        "-KopTwoUnit": "десятитисячних відсотка",
        "-KopFiveUnit": "десятитисячних відсотка",
        "-KopSex": "M"
      }
    ]
  }
};
/**
 * Converts numbers to symbols.
 *
 * @author Valentyn V Kolesnikov
 * @version $Revision$ $Date$
*/

    /** Currency. */
var Currency = new Class({
    Static: {
        /**.*/
        UAH: 'UAH',
        /**.*/
        RUR: 'RUR',
        /**.*/
        PER10: 'PER10',
        /**.*/
        PER100: 'PER100',
        /**.*/
        PER1000: 'PER1000',
        /**.*/
        PER10000: 'PER10000'
    }
});

    /** Language. */
var Language = new Class({
    Static: {
        /**.*/
        RUS: 'RUS',
        /**.*/
        UKR: 'UKR'
    }
});

    /** Pennies. */
var Pennies = new Class({
    Static: {
        /**.*/
        NUMBER: 'NUMBER',
        /**.*/
        TEXT: 'TEXT'
    }
});

var StringBuilder = new Class({
    initialize: function() {
        this._buffer = new Array();
    },

    append: function(text) {
            this._buffer[this._buffer.length] = text;
            return this;
    },
        
    insert: function(index, text) { 
            this._buffer.splice(index, 0, text);
            return this;
    },

    toString: function() {
            return this._buffer.join("");
    }
});

var MoneyToStr = new Class({
    Static: {
        NUM0: 0,
        NUM1: 1,
        NUM2: 2,
        NUM3: 3,
        NUM4: 4,
        NUM5: 5,
        NUM6: 6,
        NUM7: 7,
        NUM8: 8,
        NUM9: 9,
        NUM10: 10,
        NUM11: 11,
        NUM12: 12,
        NUM100: 100,
        NUM1000: 1000,
        INDEX_0: 0,
        INDEX_1: 1,
        INDEX_2: 2,
        INDEX_3: 3
    },
    initialize: function(currency, language, pennies){
        this.currency = currency;
        this.language = language;
        this.pennies = pennies;
        var languageElement = currencyList['CurrencyList']['language']['-value'];
        var items = currencyList['CurrencyList'][languageElement]['item'];
        this.messages = {};
        for (var index in items) {
            var languageItem = items[index];
            for (var litem in languageItem) {
                if (languageItem["-text"]) {
                console.log(litem + ' ' + languageItem[litem]);
                }
            }
            if (languageItem["-text"]) {
                this.messages[languageItem["-value"]] = languageItem["-text"].split(",");
            }
        }
        var currencyItem = currencyList['CurrencyList'][currency]
        var theISOElement = null;
        for (var index in currencyItem) {
            if (currencyItem[index]["-language"] == language) {
                theISOElement = currencyItem[index];
                break;
            }
        }
        if (!theISOElement) {
            throw new Error("Currency not found " + theISOstr);
        }
        this.rubOneUnit = theISOElement["-RubOneUnit"];
        this.rubTwoUnit = theISOElement["-RubTwoUnit"];
        this.rubFiveUnit = theISOElement["-RubFiveUnit"];
        this.kopOneUnit = theISOElement["-KopOneUnit"];
        this.kopTwoUnit = theISOElement["-KopTwoUnit"];
        this.kopFiveUnit = theISOElement["-KopFiveUnit"];
        this.rubSex = theISOElement["-RubSex"];
        this.kopSex = theISOElement["-KopSex"];
    },

    /**
     * Converts number to currency. Usage: MoneyToStr moneyToStr = new MoneyToStr("UAH"); String result =
     * moneyToStr.convert(123D); Expected: result = сто двадцять три гривні 00 копійок
     *
     * @param theMoney
     *            the amount of money major currency
     * @param theKopeiki
     *            the amount of money minor currency
     * @return the string description of money value
     */
    convert: function(theMoney, theKopeiki) {
        if (!theMoney) {
            throw new Error("theMoney is null");
        }
        if (!theKopeiki) {
            throw new Error("theKopeiki is null");
        }
        var money2str = new StringBuilder();
        var triadNum = 0;
        var theTriad = 0;
        var intPart = theMoney;
        if (intPart == 0) {
            money2str.append(messages["0"][0] + " ");
        }
        do {
            theTriad = parseInt(intPart % this.Static.NUM1000);
            money2str.insert(0, this.triad2Word(theTriad, triadNum, this.rubSex));
            if (triadNum == 0) {
                var range10 = parseInt((theTriad % this.Static.NUM100) / this.Static.NUM10);
                var range = parseInt(theTriad % this.Static.NUM10);
                if (range10 == this.Static.NUM1) {
                    money2str.append(this.rubFiveUnit);
                } else {
                    switch (range) {
                    case this.Static.NUM1:
                        money2str.append(this.rubOneUnit);
                        break;
                    case this.Static.NUM2:
                    case this.Static.NUM3:
                    case this.Static.NUM4:
                        money2str.append(this.rubTwoUnit);
                        break;
                    default:
                        money2str.append(this.rubFiveUnit);
                        break;
                    }
                }
            }
            intPart = parseInt(intPart / this.Static.NUM1000);
            triadNum++;
        } while (intPart > 0);

console.log("this.pennies - " + this.pennies + ", Pennies.TEXT - " + Pennies.TEXT);
        if (this.pennies == 'TEXT') {
            money2str.append(" ").append(theKopeiki == 0 ? this.messages["0"][0] + " " : this.triad2Word(theKopeiki, 0, this.kopSex));
        } else {
            money2str.append(" " + (theKopeiki < 10 ? "0" + theKopeiki : theKopeiki) + " ");
        }
        if (theKopeiki == this.Static.NUM11 || theKopeiki == this.Static.NUM12) {
            money2str.append(this.kopFiveUnit);
        } else {
            switch (parseInt(theKopeiki % this.Static.NUM10)) {
            case this.Static.NUM1:
                money2str.append(this.kopOneUnit);
                break;
            case this.Static.NUM2:
            case this.Static.NUM3:
            case this.Static.NUM4:
                money2str.append(this.kopTwoUnit);
                break;
            default:
                money2str.append(this.kopFiveUnit);
                break;
            }
        }
        return money2str.toString().trim();
    },
    triad2Word: function(triad, triadNum, sex) {
        var triadWord = new StringBuilder();

        if (triad == 0) {
            return "";
        }

        var range = this.check1(triad, triadWord);

        var range10 = range;
        range = parseInt(triad % this.Static.NUM10);
console.log("range - " + range + ", triad - " + triad + ", triadNum - " + triadNum);
        this.check2(triadNum, sex, triadWord, triad, range10);
        switch (triadNum) {
        case this.Static.NUM0:
            break;
        case this.Static.NUM1:
        case this.Static.NUM2:
        case this.Static.NUM3:
        case this.Static.NUM4:
            if (range10 == this.Static.NUM1) {
                triadWord.append(this.messages["1000_10"][triadNum - 1] + " ");
            } else {
                switch (range) {
                case this.Static.NUM1:
                    triadWord.append(this.messages["1000_1"][triadNum - 1] + " ");
                    break;
                case this.Static.NUM2:
                case this.Static.NUM3:
                case this.Static.NUM4:
                    triadWord.append(this.messages["1000_234"][triadNum - 1] + " ");
                    break;
                default:
                    triadWord.append(this.messages["1000_5"][triadNum - 1] + " ");
                    break;
                }
            }
            break;
        default:
            triadWord.append("??? ");
            break;
        }
        return triadWord.toString();
    },

    /**
     * @param triadNum the triad num
     * @param sex the sex
     * @param triadWord the triad word
     * @param triad the triad
     * @param range10 the range 10
     */
    check2: function(triadNum, sex, triadWord, triad, range10) {
        var range = parseInt(triad % this.Static.NUM10);
        if (range10 == 1) {
            triadWord.append(this.messages["10_19"][range] + " ");
        } else {
            switch (range) {
            case this.Static.NUM1:
                if (triadNum == this.Static.NUM1) {
                    triadWord.append(this.messages["1"][this.Static.INDEX_0] + " ");
                } else if (triadNum == this.Static.NUM2 || triadNum == this.Static.NUM3 || triadNum == this.Static.NUM4) {
                    triadWord.append(this.messages["1"][this.Static.INDEX_1] + " ");
                } else if ("M" == sex) {
                    triadWord.append(this.messages["1"][this.Static.INDEX_2] + " ");
                } else if ("F" == sex) {
                    triadWord.append(this.messages["1"][this.Static.INDEX_3] + " ");
                }
                break;
            case this.Static.NUM2:
                if (triadNum == this.Static.NUM1) {
                    triadWord.append(this.messages["2"][this.Static.INDEX_0] + " ");
                } else if (triadNum == this.Static.NUM2 || triadNum == this.Static.NUM3 || triadNum == this.Static.NUM4) {
                    triadWord.append(this.messages["2"][this.Static.INDEX_1] + " ");
                } else if ("M" == sex) {
                    triadWord.append(this.messages["2"][this.Static.INDEX_2] + " ");
                } else if ("F" == sex) {
                    triadWord.append(this.messages["2"][this.Static.INDEX_3] + " ");
                }
                break;
            case this.Static.NUM3:
            case this.Static.NUM4:
            case this.Static.NUM5:
            case this.Static.NUM6:
            case this.Static.NUM7:
            case this.Static.NUM8:
            case this.Static.NUM9:
                triadWord.append(["", "", ""].concat(this.messages["3_9"])[range] + " ");
                break;
            default:
                break;
            }
        }
    },

    /**
     * @param triad the triad
     * @param triadWord the triad word
     * @return the range
     */
    check1: function(triad, triadWord) {
        var range = parseInt(triad / this.Static.NUM100);
        triadWord.append([""].concat(this.messages["100_900"])[range]);

        range = parseInt((triad % this.Static.NUM100) / this.Static.NUM10);
        triadWord.append(["", ""].concat(this.messages["20_90"])[range]);
        return range;
    }
});
